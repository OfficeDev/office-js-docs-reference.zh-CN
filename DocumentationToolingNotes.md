# <a name="how-the-office-javascript-api-documentation-is-generated"></a><span data-ttu-id="9f47e-101">如何生成 Office JavaScript API 文档</span><span class="sxs-lookup"><span data-stu-id="9f47e-101">How the Office JavaScript API documentation is generated</span></span>

<span data-ttu-id="9f47e-102">Office JavaScript 参考文档页从类型定义文件和示例代码段生成。</span><span class="sxs-lookup"><span data-stu-id="9f47e-102">The Office JavaScript reference documentation pages are generated from type definition files and example snippets.</span></span> <span data-ttu-id="9f47e-103">此过程混合使用开放源代码工具和特定于存储库的脚本。</span><span class="sxs-lookup"><span data-stu-id="9f47e-103">This process uses a blend of open source tools and repository-specific scripts.</span></span> <span data-ttu-id="9f47e-104">本文档旨在使此存储库的流程透明，以便社区可以更好地受益于此内容并为此内容做贡献。</span><span class="sxs-lookup"><span data-stu-id="9f47e-104">This document aims to make the processes of this repository transparent so the community can better benefit from and contribute to this content.</span></span>

## <a name="content-sources"></a><span data-ttu-id="9f47e-105">内容源</span><span class="sxs-lookup"><span data-stu-id="9f47e-105">Content sources</span></span>

<span data-ttu-id="9f47e-106">组合了两种类型的内容来创建 Office-JS 参考文档：类型定义和代码段。</span><span class="sxs-lookup"><span data-stu-id="9f47e-106">Two types of content are combined to create the Office-JS reference documentation: type definitions and code snippets.</span></span> <span data-ttu-id="9f47e-107">这些示例可确保完整的 API 覆盖范围，并提供了小型的内嵌代码示例。</span><span class="sxs-lookup"><span data-stu-id="9f47e-107">These ensure complete API coverage and give small, inline code samples.</span></span>

### <a name="type-definition-files"></a><span data-ttu-id="9f47e-108">类型定义文件</span><span class="sxs-lookup"><span data-stu-id="9f47e-108">Type definition files</span></span>

<span data-ttu-id="9f47e-109">"一 [定类型"](https://github.com/DefinitelyTyped/DefinitelyTyped) 上的类型定义文件是文档唯一真实来源。</span><span class="sxs-lookup"><span data-stu-id="9f47e-109">The type definition files on [Definitely Typed](https://github.com/DefinitelyTyped/DefinitelyTyped) are the single source of truth for the documentation.</span></span> <span data-ttu-id="9f47e-110">使用 TypeScript 的任何 Office 加载项都使用这些类型定义文件进行编译。</span><span class="sxs-lookup"><span data-stu-id="9f47e-110">Any Office Add-in that uses TypeScript compiles by using these type definition files.</span></span> <span data-ttu-id="9f47e-111">这还会为 JavaScript 和 TypeScript 开发人员IntelliSense功能。</span><span class="sxs-lookup"><span data-stu-id="9f47e-111">These also give JavaScript and TypeScript developers IntelliSense capabilities.</span></span> <span data-ttu-id="9f47e-112">通过根据这些定义生成参考文档，我们提供了更准确的信息。</span><span class="sxs-lookup"><span data-stu-id="9f47e-112">By building the reference documentation from these definitions, we provide more accurate information.</span></span>

<span data-ttu-id="9f47e-113">有四个相关的 d.ts 文件，它们为文档的不同子节提供源内容。</span><span class="sxs-lookup"><span data-stu-id="9f47e-113">There are four relevant d.ts files that provide source content for different subsections of the docs.</span></span>

- <span data-ttu-id="9f47e-114">[office-js/index.d.ts](https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts) (Release definitions.) </span><span class="sxs-lookup"><span data-stu-id="9f47e-114">[office-js/index.d.ts](https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts) (The Release definitions.)</span></span>
  - [<span data-ttu-id="9f47e-115">Excel (发布) </span><span class="sxs-lookup"><span data-stu-id="9f47e-115">Excel (Release)</span></span>](https://docs.microsoft.com/javascript/api/excel_release)
  - [<span data-ttu-id="9f47e-116">OneNote</span><span class="sxs-lookup"><span data-stu-id="9f47e-116">OneNote</span></span>](https://docs.microsoft.com/javascript/api/onenote)
  - [<span data-ttu-id="9f47e-117">PowerPoint</span><span class="sxs-lookup"><span data-stu-id="9f47e-117">PowerPoint</span></span>](https://docs.microsoft.com/javascript/api/powerpoint)
  - [<span data-ttu-id="9f47e-118">Visio</span><span class="sxs-lookup"><span data-stu-id="9f47e-118">Visio</span></span>](https://docs.microsoft.com/javascript/api/visio)
  - [<span data-ttu-id="9f47e-119">Word (发布) </span><span class="sxs-lookup"><span data-stu-id="9f47e-119">Word (Release)</span></span>](https://docs.microsoft.com/javascript/api/word_release)
  - [<span data-ttu-id="9f47e-120">通用 API 的 OfficeExtensions 子节</span><span class="sxs-lookup"><span data-stu-id="9f47e-120">OfficeExtensions subsection of the Common API</span></span>](https://docs.microsoft.com/javascript/api/office)
- <span data-ttu-id="9f47e-121">[office-js-preview/index.d.ts](https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js-preview/index.d.ts) (Preview definitions.) </span><span class="sxs-lookup"><span data-stu-id="9f47e-121">[office-js-preview/index.d.ts](https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js-preview/index.d.ts) (The Preview definitions.)</span></span>
  - [<span data-ttu-id="9f47e-122">Excel (预览) </span><span class="sxs-lookup"><span data-stu-id="9f47e-122">Excel (Preview)</span></span>](https://docs.microsoft.com/javascript/api/excel)
  - [<span data-ttu-id="9f47e-123">Outlook (预览) </span><span class="sxs-lookup"><span data-stu-id="9f47e-123">Outlook (Preview)</span></span>](https://docs.microsoft.com/javascript/api/outlook)
  - [<span data-ttu-id="9f47e-124">Word (预览) </span><span class="sxs-lookup"><span data-stu-id="9f47e-124">Word (Preview)</span></span>](https://docs.microsoft.com/javascript/api/word)
  - [<span data-ttu-id="9f47e-125">通用 API</span><span class="sxs-lookup"><span data-stu-id="9f47e-125">Common API</span></span>](https://docs.microsoft.com/javascript/api/office)
- <span data-ttu-id="9f47e-126">[custom-functions-runtime/index.d.ts](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/custom-functions-runtime/index.d.ts) (Excel Custom Functions 运行时定义.) </span><span class="sxs-lookup"><span data-stu-id="9f47e-126">[custom-functions-runtime/index.d.ts](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/custom-functions-runtime/index.d.ts) (The Excel Custom Functions runtime definitions.)</span></span>
  - [<span data-ttu-id="9f47e-127">自定义函数</span><span class="sxs-lookup"><span data-stu-id="9f47e-127">Custom Functions</span></span>](https://docs.microsoft.com/javascript/api/custom-functions-runtime)
- <span data-ttu-id="9f47e-128">[office-runtime/index.d.ts](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/office-runtime/index.d.ts) (Custom Functions platform.) </span><span class="sxs-lookup"><span data-stu-id="9f47e-128">[office-runtime/index.d.ts](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/office-runtime/index.d.ts) (The office runtime definitions for the Custom Functions platform.)</span></span>
  - [<span data-ttu-id="9f47e-129">Office 运行时</span><span class="sxs-lookup"><span data-stu-id="9f47e-129">Office Runtime</span></span>](https://docs.microsoft.com/javascript/api/office-runtime)

<span data-ttu-id="9f47e-130">较旧版本的 API 具有其自己的 d.ts 文件。</span><span class="sxs-lookup"><span data-stu-id="9f47e-130">Older versions of the APIs have their own d.ts files.</span></span> <span data-ttu-id="9f47e-131">当发布新的 API 要求集时，将保留这些要求。</span><span class="sxs-lookup"><span data-stu-id="9f47e-131">These are preserved when a new API requirement set is released.</span></span> <span data-ttu-id="9f47e-132">它们也可使用版本删除 [程序工具生成](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/tools/VersionRemover.ts)。</span><span class="sxs-lookup"><span data-stu-id="9f47e-132">They can also be generated using the [Version Remover tool](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/tools/VersionRemover.ts).</span></span> <span data-ttu-id="9f47e-133">这些旧的 d.ts 文件会进行维护，以便对 API 进行修补或更改时，仍记录原始行为。</span><span class="sxs-lookup"><span data-stu-id="9f47e-133">These old d.ts files are maintained so that in the event APIs are patched or altered, the original behavior is still documented.</span></span> <span data-ttu-id="9f47e-134">如果你必须面向较早版本的 API，这将非常有用。</span><span class="sxs-lookup"><span data-stu-id="9f47e-134">This is useful if you have to target an older version of the API.</span></span>

#### <a name="testing-type-definition-file-changes"></a><span data-ttu-id="9f47e-135">测试类型定义文件更改</span><span class="sxs-lookup"><span data-stu-id="9f47e-135">Testing type definition file changes</span></span>

<span data-ttu-id="9f47e-136">Office JavaScript API 的任何文档更改都通过编辑上述四个 d.ts 文件完成。</span><span class="sxs-lookup"><span data-stu-id="9f47e-136">Any documentation changes for the Office JavaScript API are done by editing the four d.ts files mentioned above.</span></span> <span data-ttu-id="9f47e-137">但是，如果需要，例如，在 [generate-docs/script-inputs](https://github.com/OfficeDev/office-js-docs-reference/tree/master/generate-docs/script-inputs) 中编辑相应的文件并运行 [GenerateDocs.cmd，](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/GenerateDocs.cmd)可以在将 PR 提交到 DefinitelyTyped (之前测试更改。例如，测试格式如何转换为 markdown) 。</span><span class="sxs-lookup"><span data-stu-id="9f47e-137">However, you can test a change before submitting a PR to DefinitelyTyped (if you need to, for example, test how your formatting will translate into markdown) by editing the corresponding file in [generate-docs/script-inputs](https://github.com/OfficeDev/office-js-docs-reference/tree/master/generate-docs/script-inputs) and running [GenerateDocs.cmd](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/GenerateDocs.cmd).</span></span> <span data-ttu-id="9f47e-138">当系统提示时，选择"本地文件"选项。</span><span class="sxs-lookup"><span data-stu-id="9f47e-138">When prompted, select the "Local files" option.</span></span>

<span data-ttu-id="9f47e-139">将更改推送到此存储库的远程分支将导致docs.microsoft.com构建测试分支。</span><span class="sxs-lookup"><span data-stu-id="9f47e-139">Pushing changes to a remote branch of this repo causes the docs.microsoft.com platform to build a test branch.</span></span> <span data-ttu-id="9f47e-140">此分支在 review.docs.microsoft.com 上呈现，只有内部 Microsoft 人员可以访问它。</span><span class="sxs-lookup"><span data-stu-id="9f47e-140">This branch is rendered on review.docs.microsoft.com, which is only accessible by internal Microsoft personnel.</span></span> <span data-ttu-id="9f47e-141">任何查看 PR 的人都将检查评价网站的准确性。</span><span class="sxs-lookup"><span data-stu-id="9f47e-141">Anyone reviewing your PR will check the review site for accuracy.</span></span>

### <a name="code-snippets"></a><span data-ttu-id="9f47e-142">代码段</span><span class="sxs-lookup"><span data-stu-id="9f47e-142">Code snippets</span></span>

<span data-ttu-id="9f47e-143">代码示例代码段从两个源添加到引用页面：</span><span class="sxs-lookup"><span data-stu-id="9f47e-143">Code example snippets are added to the reference pages from two sources:</span></span>

- [<span data-ttu-id="9f47e-144">Script Lab 示例</span><span class="sxs-lookup"><span data-stu-id="9f47e-144">Script Lab Samples</span></span>](https://github.com/OfficeDev/office-js-snippets)
- [<span data-ttu-id="9f47e-145">本地代码段</span><span class="sxs-lookup"><span data-stu-id="9f47e-145">Local Code Snippets</span></span>](https://github.com/OfficeDev/office-js-docs-reference/tree/master/docs/code-snippets)

<span data-ttu-id="9f47e-146">本地代码段在主机特定的 yaml 文件中。</span><span class="sxs-lookup"><span data-stu-id="9f47e-146">The local snippets are in host-specific yaml files.</span></span> <span data-ttu-id="9f47e-147">其内容按类和字段进行组织，因此可以映射到引用页中的适当位置。</span><span class="sxs-lookup"><span data-stu-id="9f47e-147">Their content is organized by class and field, so it can be mapped to the appropriate place in a reference page.</span></span> <span data-ttu-id="9f47e-148">JavaScript 或 TypeScript (代码段) 通过使用 await 语句推断。</span><span class="sxs-lookup"><span data-stu-id="9f47e-148">The language of the snippet (JavaScript or TypeScript) is inferred by the use of await statements.</span></span>

<span data-ttu-id="9f47e-149">脚本实验室代码段从工作示例提取。</span><span class="sxs-lookup"><span data-stu-id="9f47e-149">The Script Lab snippets are pulled from working samples.</span></span> <span data-ttu-id="9f47e-150">目前，Excel、Outlook、PowerPoint 和 Word 示例通过映射文件映射到引用 [文档节](https://github.com/OfficeDev/office-js-snippets/tree/prod/snippet-extractor-metadata)。</span><span class="sxs-lookup"><span data-stu-id="9f47e-150">Currently, Excel, Outlook, PowerPoint, and Word samples are mapped to reference document sections through [mapping files](https://github.com/OfficeDev/office-js-snippets/tree/prod/snippet-extractor-metadata).</span></span> <span data-ttu-id="9f47e-151">这些示例方法将单个示例方法与 API 中的属性或方法匹配。</span><span class="sxs-lookup"><span data-stu-id="9f47e-151">These match individual sample methods to properties or methods in the API.</span></span> <span data-ttu-id="9f47e-152">当 office-js-snippets 存储库运行时，将创建一个包含所有映射代码段 `yarn start` 的 [yaml](https://github.com/OfficeDev/office-js-snippets/blob/prod/snippet-extractor-output/snippets.yaml) 文件。</span><span class="sxs-lookup"><span data-stu-id="9f47e-152">When the office-js-snippets repository's `yarn start` runs, [a yaml file](https://github.com/OfficeDev/office-js-snippets/blob/prod/snippet-extractor-output/snippets.yaml) containing all the mapped snippets is created.</span></span> <span data-ttu-id="9f47e-153">此 yaml 文件是参考文档工具的输入。</span><span class="sxs-lookup"><span data-stu-id="9f47e-153">This yaml file is the input into the reference documentation tooling.</span></span>

## <a name="tooling-pipeline"></a><span data-ttu-id="9f47e-154">工具管道</span><span class="sxs-lookup"><span data-stu-id="9f47e-154">Tooling pipeline</span></span>

![显示从"明确类型"到预处理器、API 提取程序、中间处理器、API 文档器以及后处理器的控件流的图像。](ToolingPipeline.png)

<span data-ttu-id="9f47e-156">在内容源和最终页面之间，文档内容将执行五个工具步骤：</span><span class="sxs-lookup"><span data-stu-id="9f47e-156">Between the content sources and the final pages, the documentation content goes through five tooling steps:</span></span>

1. [<span data-ttu-id="9f47e-157">预处理器脚本</span><span class="sxs-lookup"><span data-stu-id="9f47e-157">Preprocessor script</span></span>](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/scripts/preprocessor.ts)
1. [<span data-ttu-id="9f47e-158">API 提取程序</span><span class="sxs-lookup"><span data-stu-id="9f47e-158">API Extractor</span></span>](https://api-extractor.com/)
1. [<span data-ttu-id="9f47e-159">Midprocessor 脚本</span><span class="sxs-lookup"><span data-stu-id="9f47e-159">Midprocessor script</span></span>](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/scripts/midprocessor.ts)
1. [<span data-ttu-id="9f47e-160">API 文档器</span><span class="sxs-lookup"><span data-stu-id="9f47e-160">API Documenter</span></span>](https://github.com/microsoft/rushstack/blob/master/apps/api-documenter/README.md)
1. [<span data-ttu-id="9f47e-161">后处理器脚本</span><span class="sxs-lookup"><span data-stu-id="9f47e-161">Postprocessor script</span></span>](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/scripts/postprocessor.ts)

<span data-ttu-id="9f47e-162">预处理器会采用 d.ts 文件，并拆分为主机特定的部分。</span><span class="sxs-lookup"><span data-stu-id="9f47e-162">The preprocessor takes the d.ts files and splits them into host-specific sections.</span></span> <span data-ttu-id="9f47e-163">它将执行后续工具正确处理数据所需的任何清理。</span><span class="sxs-lookup"><span data-stu-id="9f47e-163">It performs any cleanup necessary for the subsequent tools to properly process the data.</span></span>

<span data-ttu-id="9f47e-164">API 提取程序将 d.ts 文件转换为 JSON 数据。</span><span class="sxs-lookup"><span data-stu-id="9f47e-164">API Extractor converts the d.ts files into JSON data.</span></span> <span data-ttu-id="9f47e-165">这将标记所有类型数据，从而简化分析。</span><span class="sxs-lookup"><span data-stu-id="9f47e-165">This tokenizes all the type data, allowing for easier parsing.</span></span>

<span data-ttu-id="9f47e-166">中间处理器检索代码段，将它们与正确的主机配对，并清理 Outlook 和通用 API 对象之间的交叉链接。</span><span class="sxs-lookup"><span data-stu-id="9f47e-166">The midprocessor retrieves the code snippets and pairs them with the proper hosts, and cleans up the crosslinking between Outlook and Common API objects.</span></span>

<span data-ttu-id="9f47e-167">API 文档程序将 JSON 数据转换为 .yml 文件。</span><span class="sxs-lookup"><span data-stu-id="9f47e-167">API Documenter converts the JSON data into .yml files.</span></span> <span data-ttu-id="9f47e-168">.yml 文件由将文档发布到文档发布系统的 Open Publishing System 转换为 markdown docs.microsoft.com。</span><span class="sxs-lookup"><span data-stu-id="9f47e-168">The .yml files are converted to markdown by the Open Publishing System that publishes our docs to docs.microsoft.com.</span></span> <span data-ttu-id="9f47e-169">API 文档器还包含插入代码段的特定于 Office 的扩展。</span><span class="sxs-lookup"><span data-stu-id="9f47e-169">API Documenter also contains an Office-specific extension that inserts our code snippets.</span></span>

<span data-ttu-id="9f47e-170">后置处理程序清理目录，将 .yml 文件移动到 [发布文件夹](https://github.com/OfficeDev/office-js-docs-reference/tree/master/docs/docs-ref-autogen)。</span><span class="sxs-lookup"><span data-stu-id="9f47e-170">The postprocessor cleans up the table of contents and moves the .yml files into the [publishing folder](https://github.com/OfficeDev/office-js-docs-reference/tree/master/docs/docs-ref-autogen).</span></span>

<span data-ttu-id="9f47e-171">所有五个步骤在 [GenerateDocs.cmd](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/GenerateDocs.cmd) 运行时执行。</span><span class="sxs-lookup"><span data-stu-id="9f47e-171">All five of these steps are performed when [GenerateDocs.cmd](https://github.com/OfficeDev/office-js-docs-reference/blob/master/generate-docs/GenerateDocs.cmd) is run.</span></span> <span data-ttu-id="9f47e-172">该脚本还处理节点模块安装、清除旧文件集以及每个要求集的版本类型定义文件。</span><span class="sxs-lookup"><span data-stu-id="9f47e-172">That script also handles node module installation, cleans out old file sets, and versions Type Definition files for each requirement set.</span></span>
